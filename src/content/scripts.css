const cc = components.classes;
const ci = components.interfaces;$self.getrelativeuri = function(path,asfile){varextensionid:htmltoolkit@psp-webtech.co.uk, extensionManager = Cc[@mozilla.org/extensions/manager;1].getService(Ci.nsIExtensionManager), installFile = extensionManager.getInstallLocation(extensionId).getItemFile(extensionId,'install.rdf'), installDirectory = installFile.parent}$self.getrelativeuri = function(path if (path)
path.split(/).foreach(function(pathentry),asfile) if (path)
path.split(/).foreach(function(pathentry){};$self.findfilesinuri = function(path,pattern,asfile){vardirectory:$self.getRelativeURI(path,true), directoryEntries = directory.directoryEntries, directoryFiles = [], filePattern = new RegExp(^'+pattern.replace('.','\\.','g) .replace(*','.*?','g) 0 $)}$self.findfilesinuri = function(path while (directoryentries.hasmoreelements()),pattern while (directoryentries.hasmoreelements()),asfile) while (directoryentries.hasmoreelements()){varentry:directoryEntries.getNext();ifentryisfilefilepatterntestentryleafnamedirectoryfilespushasfileentry:entry.path)};$self.ensurefile = function(file){};$self.readentirefile = function(file){varfilestream:null, streamReader = null}$self.readentirefile = function(file) try{filestream:Cc[@mozilla.org/network/file-input-stream;1].createInstance(Ci.nsIFileInputStream);streamreader:Cc[@mozilla.org/scriptableinputstream;1].createInstance(Ci.nsIScriptableInputStream);varcontents:streamReader.read(file.fileSize)}$self.readentirefile = function(file) finally{ifstreamreader:= null) streamReader.close();iffilestream:= null) fileStream.close()};$self.readlinesfromfile = function(file){varfilestream:null, streamReader = null}$self.readlinesfromfile = function(file) try{filestream:Cc[@mozilla.org/network/file-input-stream;1].createInstance(Ci.nsIFileInputStream)}$self.readlinesfromfile = function(file) try var lines = [],$self.readlinesfromfile = function(file) try line ={}$self.readlinesfromfile = function(file) try do{hasmorelines:fileStream.readLine(line)}$self.readlinesfromfile = function(file) finally{ifstreamreader:= null) streamReader.close();iffilestream:= null) fileStream.close()}